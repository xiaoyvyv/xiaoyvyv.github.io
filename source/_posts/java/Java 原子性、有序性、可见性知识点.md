---
title: Java 原子性、可见性、有序性知识点
date: 2021-12-11 20:00:00
tags: 
- java
---
### Java 原子性、可见性、有序性概览知识点

#### 原子性

> 原子性是指一个操作或多个操作要么全部执行，且执行的过程不会被任何因素打断，要么就都不执行，同一时间只有一个线程对一个变量进行操作。在多线程情况下，每个线程的执行结果不受其他线程的干扰，比如说10个线程同时对同一个共享成员变量n++100次，如果n初始值为0，n最后的值应该是1000，所以说它们是互不干扰的，这就是传说的中的原子性。但n++并不是原子性的操作，要使用AtomicInteger保证原子性。

#### 可见性

> 可见性是指某个线程修改了某一个共享变量的值，而其他线程是否可以看见该共享变量修改后的值。在单线程中肯定不会有这种问题，单线程读到的肯定都是最新的值，而在多线程编程中就不一定了。
>
> 每个线程都有自己的工作内存，线程先把共享变量的值从主内存读到工作内存，形成一个副本，当计算完后再把副本的值刷回主内存，从读取到最后刷回主内存这是一个过程，当还没刷回主内存的时候这时候对其他线程是不可见的，所以其他线程从主内存读到的值是修改之前的旧值。

像CPU的缓存优化、硬件优化、指令重排及对JVM编译器的优化，都会出现可见性的问题。

![](https://pic3.zhimg.com/v2-037270b0876b6af680d1832bcc9dca32_r.jpg)

#### 有序性

> ​		我们都知道程序是按代码顺序执行的，对于单线程来说确实是如此，但在多线程情况下就不是如此了。为了优化程序执行和提高CPU的处理性能，JVM和操作系统都会对指令进行重排，也就说前面的代码并不一定都会在后面的代码前面执行，即后面的代码可能会插到前面的代码之前执行，只要不影响当前线程的执行结果。
>
> ​		所以，指令重排只会保证当前线程执行结果一致，但指令重排后势必会影响多线程的执行结果。

​		虽然重排序优化了性能，但也是会遵守一些规则的，并不能随便乱排序，只是重排序会影响多线程执行的结果。